{{>main/header}}

<style>
    /* 버튼 스타일 */
.button-container {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.btn-custom-create {
    background-color: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
}

.btn-custom-delete {
    background-color: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
}

.btn-custom-create:hover {
    background-color: #c3e6cb;
    border-color: #b1dfbb;
}

.btn-custom-delete:hover {
    background-color: #f5c6cb;
    border-color: #f1b0b7;
}

.btn-sm {
    font-size: 0.875rem;
    padding: 0.25rem 0.5rem;
}

/* 컨테이너 스타일 */
.container {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
}

.col-form-label {
    font-weight: bold;
}

/* 기본 버튼 스타일 */
.btn-primary {
    background-color: #6c757d;
    border: none;
}

.btn-primary:hover {
    background-color: #5a6268;
}

/* 진행 상태바 컨테이너 */
.progress-container {
    position: relative;
    width: 100%;
    height: 70px; /* 높이를 조금 늘립니다 */
    margin: 20px 0;
}

.progress-bar {
    position: absolute;
    top: 38%; /* 중앙 정렬 */
    left: 10%; /* Qualification 원의 중앙에서 시작하도록 조정합니다 */
    transform: translateY(-50%);
    width: 0;
    height: 10px;
    background-color: green;
    transition: width 0.4s ease;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    width: 100%;
    margin: 20px 0;
}

.step {
    width: 30px;
    height: 30px;
    border: 2px solid #ccc;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    text-align: center;
    line-height: 30px;
    font-weight: bold;
    color: #fff;
    background-color: #ccc;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* 텍스트 스타일 */
.step::after {
    content: attr(data-step);
    position: absolute;
    top: 40px; /* 동그라미 아래에 텍스트 배치 */
    left: 50%;
    transform: translateX(-50%);
    color: #000;
    font-weight: normal;
    font-size: 14px;
}

/* 상태별 동그라미 색상 */
.step.none.active {
    background-color: black;
    border-color: black;
}

.step.draft.active {
    background-color: blue;
    border-color: blue;
}

.step.activated.active {
    background-color: green;
    border-color: green;
}

.step.completed.active {
    background-color: gray;
    border-color: gray;
}

.step.cancelled.active {
    background-color: red;
    border-color: red;
}



</style>





<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">Orders</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">Orders</li>
            </ol>

            <!-- Orders Detail -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    Orders detail
                </div>
                <div class="card-body">

                    <table id="orders_detail">
                    {{#orders}}
                    <!-- 버튼 컨테이너 -->
                    <div class="button-container mb-3">
                        <a href="/orders/detail/create" id="createButton" class="btn btn-custom-create btn-sm">
                            <i class="fas fa-plus-circle"></i> 신규
                        </a>

                        {{#orderId}}
                            <a href="/orders/detail/{{orderId}}/delete" id = "deleteButton" class="btn btn-custom-delete btn-sm">
                                <i class="fas fa-trash-alt"></i> 삭제
                            </a>
                        {{/orderId}}
                    </div>

                    <!-- 폼 시작 -->
                    {{#orderId}}
                    <form id="orderForm" action="/orders/detail/{{orderId}}/update" method="POST">
                    {{/orderId}}
                    {{^orderId}}
                    <form id="orderForm" action="/orders/detail/create" method="POST">
                    {{/orderId}}

                    <div class="mb-3 row">
                        <label for="orderDate" class="col-sm-2 col-form-label">발주일자:</label>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" id="orderDate" name="orderDate" value="{{orderDate}}" required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="salesDate" class="col-sm-2 col-form-label">매출일자:</label>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" id="salesDate" name="salesDate" value="{{salesDate}}" required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="orderStatus" class="col-sm-2 col-form-label">주문상태:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="orderStatus" name="orderStatus" required>
                                <option value="none">none</option>
                                <option value="draft">draft</option>
                                <option value="activated">activated</option>
                                <option value="completed">completed</option>
                                <option value="cancelled">cancelled</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="orderAmount" class="col-sm-2 col-form-label">수량:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="orderAmount" name="orderAmount" value="{{orderAmount}}" required>
                        </div>
                    </div>

                        <div class="mb-3 row">
                            <label for="productId" class="col-sm-2 col-form-label">제품:</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="productId" name="productId" required>
                                    <option value="">-- 제품 선택 --</option>
                                    {{#products}}
                                        <option value="{{productId}}">
                                            {{productName}} (ID: {{productId}})
                                        </option>
                                    {{/products}}
                                </select>
                            </div>
                        </div>

                        <div class="mb-3 row">
                            <label for="contractId" class="col-sm-2 col-form-label">계약:</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="contractId" name="contractId" required>
                                    <option value="">-- 계약 선택 --</option>
                                    {{#contracts}}
                                        <option value="{{contractId}}">
                                            (ID: {{contractId}})
                                        </option>
                                    {{/contracts}}
                                </select>
                            </div>
                        </div>

                    <div class="d-flex justify-content-end">
                        <button type="submit" id="updateButton" class="btn btn-custom-create btn-sm">
                            <i class="fas fa-plus-circle"></i> 저장
                        </button>
                    </div>
                </form> <!-- 폼 닫기 -->
                    {{/orders}}





                    </table>

                </div>
            </div>
        </div>


    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-table me-1"></i>
            Orders Status
        </div>
        <div class="card-body">
            <table id="orders_status">


                {{#orders}}
                    <tbody>
                    <div class="progress-container">
                        <div class="progress-steps">
                            <div class="step none" data-step="none"></div>
                            <div class="step draft" data-step="draft"></div>
                            <div class="step activated" data-step="activated"></div>
                            <div class="step completed" data-step="completed"></div>
                            <div class="step cancelled" data-step="cancelled"></div>
                        </div>
                    </div>
                    </tbody>
                {{/orders}}
            </table>
        </div>
    </div>
</main>


    <script>

    {{#orders}}
        document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("deleteButton").addEventListener("click", function(event) {
            event.preventDefault(); // 기본 링크 동작을 막습니다.

            // 사용자 확인 대화 상자 표시
            var confirmDelete = confirm("정말 삭제하시겠습니까?");

            if (confirmDelete) {
                // 사용자가 확인을 클릭한 경우 링크를 따라 갑니다.
                window.location.href = this.href;
            }
        });
    });


    document.addEventListener("DOMContentLoaded", function() {
    // Mustache 템플릿에서 서버 데이터를 가져옴
    var orderStatus = "{{orderStatus}}";
    var productId = "{{product.productId}}";
    var contractId = "{{contract.contractId}}";

    // 상태에 따른 진행상황 표시
    var progressSteps = document.querySelectorAll(".step");
    var steps = ["none", "draft", "activated", "completed", "cancelled"];
    var currentIndex = steps.indexOf(orderStatus);

    // 진행상황에 해당하는 동그라미만 채우기
    if (currentIndex !== -1) {
        progressSteps[currentIndex].classList.add("active");
    }

    // 폼에 데이터 채우기
    var orderStatusSelect = document.getElementById("orderStatus");
    if (orderStatusSelect) {
        orderStatusSelect.value = orderStatus;
    }
    document.getElementById("productId").value = productId;
    document.getElementById("contractId").value = contractId;

    // select 폼데이터 조회 기능 (main/header와 footer에 CSS 추가, 상단에 Selectize CSS, JS로 명시)



        document.addEventListener("DOMContentLoaded", function() {
            // 계약 검색
            $('#contractId').selectize({
                create: false,
                sortField: 'text'
            });

            // 제품 검색
            $('#productId').selectize({
                create: false,
                sortField: 'text'
            });
        });

    // Form 삭제버튼 클릭 시 현 주소가 create인 경우 create로 action주소 변경
    var form = document.getElementById("orderForm");
    var currentUrl = window.location.pathname;
    if (form && currentUrl === "/orders/detail/create") {
        form.action = "/orders/detail/create";
    }

    // 저장 버튼 클릭 시 변경사항 저장 여부 확인
    var updateButton = document.getElementById("updateButton");
    if (updateButton) {
        updateButton.addEventListener("click", function(event) {
            var confirmSave = confirm("변경사항을 저장하겠습니까?");
            if (!confirmSave) {
                event.preventDefault();
            }
        });
    }
});
    Handlebars.registerHelper('ifEquals', function (arg1, arg2, options) {
    return arg1 === arg2 ? options.fn(this) : options.inverse(this);
});

    {{/orders}}
    </script>



    {{>main/footer}}